<ui:composition template="/templates/surveyTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:en="http://encuesta.me/encuestame">
	<ui:define name="title"> #{temp.surveyTitle}</ui:define>
	<ui:define name="bodyOptions">
		<h2>#{temp.builSurvey}</h2>
		<rich:messages id="infoBox" errorClass="error" infoClass="info"
			warnClass="war">
		</rich:messages>
		<rich:modalPanel id="panelnewSeccion" autosized="true" width="600"
			height="200" zindex="2000">
			<f:facet name="header">
				<a4j:form id="formHeaderNewtSection">
					<h:panelGroup>
						<h:outputText value="Nuevo Seccion"></h:outputText>
					</h:panelGroup>
				</a4j:form>
			</f:facet>
			<f:facet name="controls">
				<a4j:form ajaxSubmit="true">
					<h:panelGroup>
						<a4j:commandLink
							onclick="Richfaces.hideModalPanel('panelnewSeccion')"
							ajaxSingle="true">
							<h:graphicImage value="#{url.img}/icons/close.png" />
						</a4j:commandLink>
					</h:panelGroup>
				</a4j:form>
			</f:facet>
			<a4j:form>
				<h:panelGrid columns="2">
					<h:outputLabel value="name" for="" />
					<h:inputText value="#{unitSurveySection.name}" />
					<a4j:commandButton value="Crear"
						action="#{surveyControllerBean.createSecction}"
						oncomplete="Richfaces.hideModalPanel('panelnewSeccion')"
						reRender="cSurForm">
						<rich:effect event="oncomplete" targetId="panelnewSeccion"
							type="Fade" params="delay:1.0,duration:0.5" />
						<rich:effect event="oncomplete" targetId="infoBox" type="Appear"
							params="delay:2.0,duration:0.5" />
					</a4j:commandButton>
				</h:panelGrid>
			</a4j:form>
		</rich:modalPanel>
		<rich:modalPanel id="panelnewQuestion" autosized="true" width="600"
			height="200" zindex="2000">
			<f:facet name="header">
				<a4j:form id="formHeaderNewtQuestion">
					<h:panelGroup>
						<h:outputText id="headerEditUser" value="Nueva Pregunta"></h:outputText>
					</h:panelGroup>
				</a4j:form>
			</f:facet>
			<f:facet name="controls">
				<a4j:form ajaxSubmit="true">
					<h:panelGroup>
						<a4j:commandLink
							onclick="Richfaces.hideModalPanel('panelnewSeccion')"
							ajaxSingle="true">
							<h:graphicImage value="#{url.img}/icons/close.png" />
						</a4j:commandLink>
					</h:panelGroup>
				</a4j:form>
			</f:facet>
			<a4j:form>
				<h:panelGrid columns="2">
					<h:outputLabel value="Question" for="" />
					<h:inputText value="#{unitQuestionBean.questionName}" />
					<h:outputLabel value="Patron" for="" />
					<h:selectOneMenu value="#{surveyControllerBean.patternSelected}"
						id="selectState" required="true"
						requiredMessage="Es necesario el patron">
						<f:selectItems value="#{globalBean.loadListQuestionPattern}" />
					</h:selectOneMenu>
					<a4j:commandButton value="Crear"
						action="#{surveyControllerBean.createQuestion}"
						oncomplete="Richfaces.hideModalPanel('panelnewQuestion')"
						reRender="cSurForm">
						<rich:effect event="oncomplete" targetId="panelnewSeccion"
							type="Fade" params="delay:1.0,duration:0.5" />
						<rich:effect event="oncomplete" targetId="infoBox" type="Appear"
							params="delay:2.0,duration:0.5" />
					</a4j:commandButton>
				</h:panelGrid>
			</a4j:form>
		</rich:modalPanel>
		<a4j:form id="cSurForm">
			<h3>#{surveyFormatBean.surveyName}</h3>
			<h:panelGrid columns="5" cellpadding="4" cellspacing="4">

				<a4j:commandLink value="Crear Pregunta"
					oncomplete="javascript:Richfaces.showModalPanel('panelnewQuestion')"></a4j:commandLink>
			</h:panelGrid>
			<rich:dragIndicator id="indicator">
				<f:facet name="multiple">
					<f:verbatim>
						<b>Single item</b> {DragInfo}
					</f:verbatim>
				</f:facet>
			</rich:dragIndicator>
			<table>
				<tr>
					<td valign="top" width="300px"><h:panelGroup>
						<h:panelGrid columns="1">
							<h:outputLabel value="Buscar Preguntas" for="" />
							<h:inputText value="" />
							<a4j:commandButton value="Buscar"></a4j:commandButton>
						</h:panelGrid>
						<a4j:repeat value="#{surveyControllerBean.questionsList}" var="fm">
							<a4j:outputPanel styleClass="questionBox" layout="block"
								style="wi">
								<h:outputText value="#{fm.questionName}"></h:outputText>
								<rich:dragSupport dragIndicator=":indicator" dragType="PHP"
									dragValue="#{fm}" reRender="repeatSeccion,cSurForm">
									<rich:dndParam name="label" value="#{fm.id}" />
								</rich:dragSupport>
							</a4j:outputPanel>
						</a4j:repeat>
					</h:panelGroup></td>
					<td valign="top"><h:panelGroup>
						<a4j:region id="sectionRegion">

							<h:panelGrid columns="100" cellpadding="4" cellspacing="5">
								<a4j:repeat id="repeatSeccionss"
									value="#{surveyControllerBean.sectionList}" var="seccion">
									<a4j:outputPanel styleClass="secctionTab"
										style="width: 40%;border: 1px solid gray;	padding: 5px;margin: 3px;">
										<a4j:commandLink value="#{seccion.name}"
											action="#{surveyControllerBean.changeRenderedSection}"
											reRender="cSurForm">
											<a4j:actionparam name="sectionId" value="#{seccion.id}"
												assignTo="#{surveyControllerBean.sectionSelected}"></a4j:actionparam>
										</a4j:commandLink>
									</a4j:outputPanel>
								</a4j:repeat>
								<a4j:commandLink value="Crear Seccion"
									oncomplete="javascript:Richfaces.showModalPanel('panelnewSeccion')">
								</a4j:commandLink>
							</h:panelGrid>


							<a4j:status for="sectionRegion" startText="Cargando..."></a4j:status>
							<a4j:repeat id="repeatSeccion"
								value="#{surveyControllerBean.sectionList}" var="seccion">
								<rich:panel styleClass="dropTargetPanel" style="width:100%;"
									rendered="#{seccion.showPanel}">
									<h:outputText value="#{seccion.name}" />
									<rich:dropSupport acceptedTypes="PHP" dropValue="#{seccion}"
										dropListener="#{buildEventSurvey.processDrop}"
										reRender="repeatSeccion,cSurForm">
									</rich:dropSupport>
									<a4j:repeat value="#{seccion.questions}" var="question">
										<rich:panel>
											<en:pattern value="#{question}" />
											<h:outputText value="#{question.questionName}" />
										</rich:panel>
									</a4j:repeat>
								</rich:panel>
							</a4j:repeat>
						</a4j:region>
					</h:panelGroup></td>
				</tr>
			</table>
		</a4j:form>
	</ui:define>
</ui:composition>