<ui:composition template="pollTemplate.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:c="http://java.sun.com/jstl/core">
    xmlns:sf="http://www.springframework.org/tags/faces">
    <ui:define name="title"></ui:define>
    <ui:define name="bodyOptions">
           <a4j:outputPanel id="viewPoll">
                <h:outputText value="#{pollBean.selectedFolder}" />
           </a4j:outputPanel>
    </ui:define>
    <ui:define name="panel">
        <a4j:form id="panelForm" ignoreDupResponses="true">
            <div>
                <a4j:commandLink value="New Folder" rendered="true"
                    oncomplete="javascript:Richfaces.showModalPanel('createGroup')"
                    reRender="newFormUserUnit,formHeaderNewtUser">
                </a4j:commandLink>
            </div>
            <rich:panelBar id="panelFolder" height="400" width="250"
                  valueChangeListener="#{pollBean.panelBarChanged}"
                  selectedPanel="#{pollBean.selectedPanel}" >
                <a4j:support event="onitemchange" reRender="items" />
                <c:forEach items="#{pollBean.pollFolders}" var="folder">
                    <rich:panelBarItem label="#{folder.folderName}" >
                         <a4j:support event="onenter" action="#{pollBean.loadFolderItems}" reRender="viewPoll">
                                <f:setPropertyActionListener value="#{folder}" target="#{pollBean.selectedFolder}"/>
                         </a4j:support>
                    <h:panelGroup id="items">
                             <a4j:repeat value="#{pollBean.polls}" var="poll">
                                    <div class="pollItemView">
                                        <a4j:commandLink value="#{poll.questionBean.questionName}">
                                                <a4j:support event="onclick" reRender="viewPoll" action="#{pollBean.loadPollItemView}">
                                                      <f:setPropertyActionListener value="#{poll}" target="#{pollBean.pollSelected}"/>
                                                </a4j:support>
                                        </a4j:commandLink>
                                    </div>
                             </a4j:repeat>
                     </h:panelGroup>
                    </rich:panelBarItem>
                </c:forEach>

            </rich:panelBar>
        </a4j:form>
        <rich:modalPanel id="createGroup" autosized="true"
            width="600" height="200" zindex="2000">
            <f:facet name="header">
                <h:form id="formHeaderNewtUser">
                    <h:panelGroup>
                        <h:outputText id="headerEditUser"
                            value="New Folder"></h:outputText>
                    </h:panelGroup>
                </h:form>
            </f:facet>
            <f:facet name="controls">
                <h:form>
                    <h:panelGroup>
                        <a4j:commandLink
                            onclick="Richfaces.hideModalPanel('createGroup')"
                            ajaxSingle="true">
                            <div>close window</div>
                        </a4j:commandLink>
                    </h:panelGroup>
                </h:form>
            </f:facet>
            <a4j:form>
                <h:panelGrid columns="2">
                    <h:outputLabel value="Name" />
                    <h:inputText value="#{pollBean.newFolder.folderName}" />
                </h:panelGrid>
                <a4j:commandButton value="Save" action="#{pollBean.saveNewFolder}"
                 oncomplete="Richfaces.hideModalPanel('createGroup')" reRender="panelFolder"></a4j:commandButton>
            </a4j:form>
            </rich:modalPanel>
    </ui:define>
</ui:composition>
