<ui:composition template="../../layouts/admonTemplate.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:sf="http://www.springframework.org/tags/faces"
    xmlns:sec="http://www.springframework.org/security/tags">
    <ui:define name="title"> #{msg.admonTitle} - #{msg.titleUser}</ui:define>
    <ui:define name="bodyOptions">
        <a4j:form id="formUsers" ajaxSubmit="true">
            <!-- Options Table -->
            <span class="admonUserHeader">
                <h2>#{msg.titleUserGroups}</h2>
            </span>
            <!-- Option Menu -->
            <div style="float: right;">
                <a4j:commandLink value="#{msg.newUser}" rendered="true"
                    oncomplete="javascript:Richfaces.showModalPanel('panelnewUserGroup')"
                    reRender="newFormUserUnit,formHeaderNewtUser">
                </a4j:commandLink>
             </div>
            <rich:messages id="infoBox" errorClass="error"
                infoClass="info" warnClass="war"></rich:messages>
            <h:panelGrid columns="9" cellpadding="3">
                <h:panelGroup>
                    <h:selectOneMenu id="listActions" immediate="true"
                        value="#{userBean.selectedAction}">
                        <f:selectItem itemLabel="Seleccione..."
                            itemValue="" />
                        <f:selectItem itemLabel="Eliminar" itemValue="1" />
                        <f:selectItem itemLabel="Recordar Contrasenia"
                            itemValue="2" />
                        <f:selectItem itemLabel="Editor" itemValue="3" />
                    </h:selectOneMenu>
                    <a4j:commandButton value="Aplicar"
                        action="#{userBean.initAction}"
                        reRender="formUsers,listActions,infoBox"></a4j:commandButton>
                </h:panelGroup>
                <h:panelGroup>
                    <h:selectOneMenu id="selectPermission"
                        value="#{userBean.selectedPermissionId}"
                        requiredMessage="Es necesario un rol">
                        <f:selectItems
                            value="#{globalBean.loadListPermissions}" />
                    </h:selectOneMenu>
                    <h:message for="selectPermission" />
                    <a4j:commandButton value="Asignar Rol"
                        action="#{userBean.assingPermissions}"
                        reRender="formUsers"></a4j:commandButton>
                </h:panelGroup>
            </h:panelGrid>

            <!-- Users Table -->

            <rich:dataTable id="dataTableUsers" width="100%"
                style="margin: 5px; margin-top: 12px;" headerClass="userAdmonHeader" rowClasses="rowClass" value="#{users}"
                var="unitUser" rendered="#{users.rowCount > 0}">
                <f:facet name="header">
                    <rich:columnGroup columnClasses="classColumnd">
                        <rich:column width="20px">
                            <h:selectBooleanCheckbox />
                        </rich:column>
                        <rich:column>
                            <h:outputText value="#{msg.username}" />
                        </rich:column>
                        <rich:column>
                            <h:outputText value="#{msg.name}" />
                        </rich:column>
                        <rich:column>
                            <h:outputText value="#{msg.groups}" />
                        </rich:column>
                         <rich:column width="100px">
                            <h:outputText value="Operations" />
                        </rich:column>
                    </rich:columnGroup>
                </f:facet>
                <rich:column width="20px">

                </rich:column>
                <rich:column>
                    <h:outputText value="#{unitUser.username}" />
                </rich:column>
                <rich:column>
                    <h:outputText value="#{unitUser.name}" />
                </rich:column>
                <rich:column>
                    <a4j:repeat value="#{unitUser.listGroups}"
                        var="group">
                        <h:outputText value="#{group.groupName}" />
                    </a4j:repeat>
                </rich:column>
                <rich:column width="100px">
                    <span class="spaceOptionColumn">
                        <a4j:commandLink value="Edit"
                            action="#{userBean.loadSelectUser}"
                            oncomplete="javascript:Richfaces.showModalPanel('panelUserGroup')" reRender="panelUserGroup">
                            <a4j:actionparam name="userId"
                                value="#{unitUser.username}"
                                assignTo="#{userBean.processedUserId}"></a4j:actionparam>
                        </a4j:commandLink>
                    </span>

                     <h:outputText value="|" />

                    <span class="spaceOptionColumn">
                        <a4j:commandLink value="Delete"
                            action="delete"
                            reRender="#{flowRenderFragments}">
                        </a4j:commandLink>
                    </span>
                </rich:column>
            </rich:dataTable>
        </a4j:form>

        <!-- Panels -->

        <ui:fragment rendered="not false">
            <h3>#{msg.notfoundGroups}</h3>
        </ui:fragment>
        <!-- MODAL PANELS -->
        <rich:modalPanel id="panelUserGroup" autosized="true"
            width="200" height="60" zindex="2000">
            <f:facet name="header">
                <h:form id="formHeaderEditUser">
                    <h:panelGroup>
                        <h:outputText id="headerEditUser"
                            value="#{userBean.unitUserBean.name}"></h:outputText>
                    </h:panelGroup>
                </h:form>
            </f:facet>
            <f:facet name="controls">
                <h:form>
                    <h:panelGroup>
                        <a4j:commandLink
                            onclick="Richfaces.hideModalPanel('panelUserGroup')"
                            ajaxSingle="true">
                            <h:graphicImage value="/icons/close.png" />
                        </a4j:commandLink>
                    </h:panelGroup>
                </h:form>
            </f:facet>
            <h:form id="editFormUserUnit">
                <rich:tabPanel switchType="client">
                    <rich:tab label="User Account" focus="true">
                        <p style="font-weight: bold;"><h:outputText
                            value="Usuario desde #{userBean.unitUserBean.dateNew}" /></p>
                        <h:panelGrid columns="2" width="400px">
                            <h:outputLabel value="Username"
                                for="username" />
                            <h:inputText id="username"
                                value="#{userBean.unitUserBean.username}"
                                disabled="true" size="20" />
                            <h:outputLabel value="Complete Name"
                                for="realName" />
                            <h:inputText id="realName"
                                value="#{userBean.unitUserBean.name}"
                                required="true" requiredMessage="test"
                                size="40" />
                            <h:outputLabel value="Email" for="email" />
                            <h:inputText id="email"
                                value="#{userBean.unitUserBean.email}"
                                required="true" size="50" />
                            <h:outputLabel value="Active" for="status" />
                            <h:panelGroup>
                                <h:panelGrid columns="2">
                                    <h:selectOneRadio id="status"
                                        value="#{userBean.unitUserBean.status}">
                                        <f:selectItem itemValue="true"
                                            itemLabel="Yes" />
                                        <f:selectItem itemValue="false"
                                            itemLabel="No" />
                                    </h:selectOneRadio>
                                </h:panelGrid>
                            </h:panelGroup>
                            <a4j:commandButton value="Update"
                                action="#{userBean.updateUser}"
                                oncomplete="Richfaces.hideModalPanel('panelUserGroup')"
                                reRender="dataTableUsers"></a4j:commandButton>
                            <h:inputHidden id="idHd"
                                value="#{userBean.unitUserBean.id}" />
                        </h:panelGrid>
                    </rich:tab>
                        <rich:tab label="Groups">
                         <rich:pickList value="#{userBean.listGroups}">
                               <f:selectItems value="#{groups}"></f:selectItems>
                               <a4j:support event="onlistchanged" ajaxSingle="true" action="#{userBean.updateGroups}"/>
                        </rich:pickList>
                        </rich:tab>
                    <rich:tab label="Permissions">
                         <rich:pickList value="#{userBean.listPermissions}">
                               <f:selectItems value="#{permissions}"></f:selectItems>
                               <a4j:support event="onlistchanged" ajaxSingle="true"/>
                        </rich:pickList>
                    </rich:tab>
                </rich:tabPanel>
            </h:form>
        </rich:modalPanel>

        <!-- NEW USER -->

        <rich:modalPanel id="panelnewUserGroup" autosized="true"
            width="600" height="200" zindex="2000">
            <f:facet name="header">
                <h:form id="formHeaderNewtUser">
                    <h:panelGroup>
                        <h:outputText id="headerEditUser"
                            value="Nuevo Usuario"></h:outputText>
                    </h:panelGroup>
                </h:form>
            </f:facet>
            <f:facet name="controls">
                <h:form>
                    <h:panelGroup>
                        <a4j:commandLink
                            onclick="Richfaces.hideModalPanel('panelnewUserGroup')"
                            ajaxSingle="true">
                            <div>close window</div>
                        </a4j:commandLink>
                    </h:panelGroup>
                </h:form>
            </f:facet>
            <b>Como agregar un usuario al Sistema</b>
            <br />
            <p>Existen tres formas para agregar un usuario, puede
            ser directamente ingresando sus datos, enviando una
            invitacion y el usuario directamente agregara sus datos o
            buscandolo en el LDAP de la empresa.</p>
            <rich:panelBar>
                <rich:panelBarItem label="Agregar Usuario Directamente">
                    <h:form id="newFormUserUnit">
                        <a4j:region id="newUserRegion">
                            <a4j:status
                                startText="Searching...."
                                startStyleClass="buscandoText"
                                stopText="" for="newUserRegion">
                            </a4j:status>
                            <h:panelGrid columns="2" cellpadding="1"
                                width="400px">
                                <h:outputLabel value="Username"
                                    for="username" />
                                <h:inputText id="username"
                                    value="#{userBean.newUnitUserBean.username}"
                                    size="20">
                                    <a4j:support event="onblur"
                                        action="#{userBean.validateUserName}"
                                        reRender="newFormUserUnit"
                                        ajaxSingle="true"></a4j:support>
                                </h:inputText>
                                <h:outputLabel value="Correo"
                                    for="email" />
                                <h:inputText id="email"
                                    value="#{userBean.newUnitUserBean.email}"
                                    required="true" size="40">
                                    <a4j:support event="onblur"
                                        action="#{userBean.validateEmail}"
                                        reRender="newFormUserUnit"
                                        ajaxSingle="true"></a4j:support>
                                </h:inputText>
                                <h:commandButton value="Create"
                                    action="createUser"
                                    oncomplete="Richfaces.hideModalPanel('panelnewUserGroup')"
                                    reRender="#{flowRenderFragments}"></h:commandButton>
                            </h:panelGrid>
                        </a4j:region>
                    </h:form>
                </rich:panelBarItem>
                <rich:panelBarItem label="Invitar Usuario por Correo">
                    <h:form id="newFormUserUnit2">
                        <p>Introduce una lista de correos, separados
                        por una coma. Cada uno de ellos recibira una
                        invitacion valida por un tiempo determinado,
                        donde podran registrarse.</p>
                        <h:panelGrid columns="2" cellpadding="2"
                            width="400px">
                            <h:outputLabel value="Escribe el Correo"
                                for="" />
                            <h:inputTextarea
                                value="#{userBean.listUsers}" cols="40"
                                rows="5" required="true" />
                            <a4j:commandButton value="Enviar Ivitacion"
                                action="#{userBean.inviteUser}"
                                oncomplete="Richfaces.hideModalPanel('panelnewUserGroup')"
                                reRender="newFormUserUnit2"></a4j:commandButton>
                        </h:panelGrid>
                    </h:form>
                </rich:panelBarItem>
                <rich:panelBarItem label="Buscar en LDAP">
                    <h:form id="newFormUserUnit3">
                        <h:panelGrid columns="2" cellpadding="2"
                            width="400px">
                            <h:outputLabel value="Nombre de Usuario"
                                for="" />
                            <h:inputText value="" size="40" />
                            <a4j:commandButton value="Buscar"></a4j:commandButton>
                        </h:panelGrid>
                        <h4>Usuarios Encontrados</h4>
                    </h:form>
                </rich:panelBarItem>
            </rich:panelBar>
        </rich:modalPanel>
    </ui:define>
</ui:composition>
