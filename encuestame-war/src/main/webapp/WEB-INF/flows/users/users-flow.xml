<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

    <var name="userBean" class="org.encuestame.web.beans.admon.UserBean" />

    <view-state id="users">
        <on-render>
            <evaluate expression="securityService.loadListUsers(currentUser.name)" result="flowScope.users"
                      result-type="dataModel" />
            <evaluate expression="securityService.loadSelectItemGroups(currentUser.name)" result="flowScope.groups" />
            <evaluate expression="securityService.loadSelectItemPermissions()" result="flowScope.permissions" />
        </on-render>

        <transition on="createUser">
             <evaluate expression="userBean.createUser(currentUser.name)"/>
             <render fragments="dataTableUsers" />
        </transition>

        <transition on="searchLdap" >
             <evaluate expression="userBean.searchLDAPUser()"/>
             <render fragments="dataTableUsers" />
        </transition>

        <transition on="sendInvitation" >
            <evaluate expression="userBean.inviteUser()"/>
             <render fragments="dataTableUsers" />
        </transition>

        <transition on="delete" >
             <set name="flowScope.userSelected" value="users.selectedRow" />
             <evaluate expression="userBean.deleteUser(flowScope.userSelected)"/>
             <render fragments="dataTableUsers" />
        </transition>

    </view-state>

    <view-state id="succesfull">
        <transition on="confirm" to="succesfullEnd" >
        </transition>
    </view-state>

    <end-state id="succesfullEnd" view="externalRedirect:contextRelative:/login.do"></end-state><!--

    <global-transitions>
            <transition on-exception="org.encuestame.core.exception.EnMeExpcetion" to="error"/>
    </global-transitions>

--></flow>
