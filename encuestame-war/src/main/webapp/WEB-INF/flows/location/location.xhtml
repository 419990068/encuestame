<ui:composition template="../../layouts/admonTemplate.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:sf="http://www.springframework.org/tags/faces"
    xmlns:sec="http://www.springframework.org/security/tags"
    xmlns:m="http://code.google.com/p/gmaps4jsf/">
    <ui:define name="googleMaps">
        <script
            src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=#{applicationServices.apiKeygoogle}"
            type="text/javascript">
    </script>
    </ui:define>
    <ui:define name="title"> #{msg.locTitle} - #{msg.titleLoc}></ui:define>
    <ui:define name="bodyOptions">
        <!-- Menu -->
        <a4j:form ajaxSubmit="true">
            <h:panelGrid columns="4">
                <a4j:commandLink value="New Folder" rendered="true"
                    oncomplete="javascript:Richfaces.showModalPanel('panelnewLocType')"
                    reRender="formHeaderNewLoc"></a4j:commandLink>
            </h:panelGrid>
        </a4j:form>
        <!-- New Folder -->
        <rich:modalPanel id="panelnewLocType" autosized="true"
            width="600" zindex="2000">
            <f:facet name="header">
                <a4j:form id="formHeaderNewLoc">
                    <h:panelGroup>
                        <h:outputText id="headerEditLoc"
                            value="Nuevo Tipo Localizacion">
                        </h:outputText>
                    </h:panelGroup>
                </a4j:form>
            </f:facet>
            <f:facet name="controls">
                <a4j:form ajaxSubmit="true">
                    <h:panelGroup>
                        <a4j:commandLink
                            onclick="Richfaces.hideModalPanel('panelnewLocType')"
                            ajaxSingle="true">
                            <h:graphicImage value="/icons/close.png" />
                        </a4j:commandLink>
                    </h:panelGroup>
                </a4j:form>
            </f:facet>
            <a4j:form id="LocForm" ajaxSubmit="true">
                <h2>#{msg.titleCreateGroups}</h2>
                <h:panelGrid columns="2">
                    <h:outputLabel value="Name" for="name" />
                    <h:inputText id="name"
                        value="#{locationBean.folderNewName}" size="40"
                        required="true"
                        requiredMessage="#{msg.validateNameLocType}" />
                    <a4j:commandButton value="Create"
                        action="#{locationBean.createFolder}"
                        oncomplete="Richfaces.hideModalPanel('panelnewLocType')"
                        reRender="treeLocationForm" />
                    <a4j:commandButton value="Cancel"
                        oncomplete="Richfaces.hideModalPanel('panelnewLocType')">
                    </a4j:commandButton>
                </h:panelGrid>
                <rich:messages errorClass="error" infoClass="info"
                    warnClass="war"></rich:messages>
            </a4j:form>
        </rich:modalPanel>
        <div class="locationContentWrapper">
        <div style="float: left; width: 300px; margin-right: 10px;">
        <h:form id="treeLocationForm">
            <rich:tree style="width:300px"
                nodeSelectListener="#{locationBean.processSelection}"
                reRender="selectedNode, map" ajaxSubmitSelection="true"
                switchType="client" value="#{locationBean.treeNode}"
                var="item" ajaxKeys="#{null}" dragIndicator="indicator2">
                <rich:treeNode ajaxSingle="true"
                    dragListener="#{item.processDrag}"
                    dropListener="#{item.processDrop}"
                    dragType="#{item.node}" acceptedTypes="item">
                    <h:outputText value="#{item.name}" />
                </rich:treeNode>
            </rich:tree>
        </h:form></div>
        <div style="float: left; background-color: #EEEEEE; width: 75%">
        <h:form id="selectedNode">
            <ui:fragment
                rendered="${locationBean.detailLocation ne null}">
                <h:panelGrid columns="2">
                    <h:outputLabel value="Name" />
                    <h:inputText
                        value="#{locationBean.detailLocation.name}">
                        <a4j:support event="onchange"
                            action="#{locationBean.updateTreeNodeName}"
                            reRender="treeLocationForm" />
                    </h:inputText>
                    <h:outputLabel value="Position" />
                    <f:view contentType="text/html">
                        <m:map width="800px" height="300px"
                            latitude="#{locationBean.detailLocation.lat}"
                            longitude="#{locationBean.detailLocation.lng}"
                            renderOnWindowLoad="false">
                            <m:marker
                                latitude="#{locationBean.detailLocation.lat}"
                                longitude="#{locationBean.detailLocation.lng}"
                                draggable="true"
                                submitOnValueChange="true"
                                valueChangeListener="#{locationBean.processValueMarkeChange}" />
                            <m:mapControl name="GLargeMapControl"
                                position="G_ANCHOR_BOTTOM_RIGHT" />
                            <m:mapControl name="GMapTypeControl" />
                        </m:map>
                    </f:view>
                </h:panelGrid>
                <h:panelGrid columns="2">
                    <h:outputLabel value="Latitude" />
                    <h:outputText
                        value="#{locationBean.detailLocation.lat}" />
                    <h:outputLabel value="Longitude" />
                    <h:outputText
                        value="#{locationBean.detailLocation.lng}" />
                    <h:outputLabel value="Address" />
                    <h:outputText
                        value="#{locationBean.detailLocation.address}" />
                    <h:outputLabel value="Country Name" />
                    <h:outputText
                        value="#{locationBean.detailLocation.countryName}" />
                    <h:outputLabel value="Country Code" />
                    <h:outputText
                        value="#{locationBean.detailLocation.countryCode}" />
                </h:panelGrid>
                <rich:panel>
                    <h:panelGrid columns="1">
                        <h:outputText
                            value="Delete this item" />
                        <a4j:commandButton value="Delete" action="#{locationBean.deleteLocationItem}"
                            reRender="treeLocationForm,selectedNode"></a4j:commandButton>
                    </h:panelGrid>
                </rich:panel>
            </ui:fragment>
            <ui:fragment
                rendered="${locationBean.detailFolderLocation ne null}">
                <rich:tabPanel switchType="client">
                    <rich:tab label="Update Data">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Name" />
                            <h:inputText
                                value="#{locationBean.detailFolderLocation.name}" />
                            <a4j:commandButton value="Update Name"
                                reRender="treeLocationForm"
                                action="#{locationBean.updateFolderName}">
                            </a4j:commandButton>
                        </h:panelGrid>
                    </rich:tab>
                    <rich:tab label="Position">
                    </rich:tab>
                    <rich:tab label="Items">
                        <rich:dataTable id="itemsByFolderTable"
                            value="#{locationBean.itemsBySelectedFolder}"
                            var="itemFolder" style="width:100%;">
                            <f:facet name="header">
                                <rich:columnGroup>
                                    <rich:column >
                                        <h:outputText value="Name" />
                                    </rich:column>
                                    <rich:column>
                                        <h:outputText value="Address" />
                                    </rich:column>
                                    <rich:column>
                                        <h:outputText value="Country" />
                                    </rich:column>
                                    <rich:column>
                                        <h:outputText value="Code" />
                                    </rich:column>
                                </rich:columnGroup>
                            </f:facet>
                            <rich:column>
                                <h:outputText value="#{itemFolder.name}" />
                            </rich:column>
                            <rich:column>
                                <h:outputText
                                    value="#{itemFolder.address}" />
                            </rich:column>
                            <rich:column>
                                <h:outputText
                                    value="#{itemFolder.countryName}" />
                            </rich:column>
                            <rich:column>
                                <h:outputText
                                    value="#{itemFolder.countryCode}" />
                            </rich:column>
                        </rich:dataTable>
                        <rich:panel>
                            <h:panelGrid columns="1">
                                <h:outputText
                                    value="New Item" />
                                <a4j:commandButton value="Add"
                                    reRender="treeLocationForm, itemsByFolderTable"
                                    action="#{locationBean.addNewItem}"></a4j:commandButton>
                            </h:panelGrid>
                        </rich:panel>
                    </rich:tab>
                </rich:tabPanel>
                <rich:panel>
                    <h:panelGrid columns="1">
                        <h:outputText
                            value="Delete this item and their childrens" />
                        <a4j:commandButton value="Delete" action="#{locationBean.deleteLocationFolder}"
                            reRender="treeLocationForm,selectedNode"></a4j:commandButton>
                    </h:panelGrid>
                </rich:panel>
            </ui:fragment>
        </h:form></div>
        </div>
    </ui:define>
</ui:composition>