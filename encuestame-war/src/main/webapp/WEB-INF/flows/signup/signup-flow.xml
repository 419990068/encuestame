<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

    <var name="signUpBean" class="org.encuestame.utils.security.SignUpBean" />

    <view-state id="signup" model="signUpBean">
        <binder>
            <binding property="username" />
            <binding property="email" />
            <binding property="captcha" />
        </binder>
        <transition on="saveUser" to="findFriends" validate="true" history="discard">
               <evaluate expression="securityService.singupUser(signUpBean)" result="flowScope.userAccount"
                         result-type="org.encuestame.utils.web.UnitUserBean"/>
        </transition>
    </view-state>

    <view-state id="findFriends" model="signUpBean">
        <transition on="next" to="profile" history="discard" />
    </view-state>

    <view-state id="profile" model="signUpBean">
        <transition on="next" to="isActivated" history="discard" />
    </view-state>

     <view-state id="noActivated" model="signUpBean">
        <transition on="review" to="isActivated" history="discard" />
    </view-state>

    <action-state id="isActivated">
        <evaluate expression="securityService.isActivated(signUpBean)" />
        <transition on="yes" to="dashboard">
        </transition>
        <transition on="no" to="noActivated" />
    </action-state>

    <end-state id="dashboard" view="externalRedirect:contextRelative:/account/dashboard.do"></end-state>


</flow>
