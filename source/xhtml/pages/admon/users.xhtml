<ui:composition template="/templates/admonTemplate.xhtml"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich">
  <ui:define name="title"> #{temp.admonTitle} - #{temp.titleUser}</ui:define>
  <ui:define name="bodyOptions">
    <a4j:form id="formUsers" ajaxSubmit="true">
      <h:panelGrid columns="8">
        <a4j:commandLink value="#{temp.newUser}" rendered="true"
          oncomplete="javascript:Richfaces.showModalPanel('panelnewUserGroup')"
          reRender="newFormUserUnit,formHeaderNewtUser">
        </a4j:commandLink>
      </h:panelGrid>
      <h2>#{temp.titleUserGroups}</h2>
      <rich:messages id="infoBox" errorClass="error" infoClass="info"
        warnClass="war"></rich:messages>
      <h:panelGrid columns="9" cellpadding="3">
        <h:panelGroup>
          <h:selectOneMenu id="listActions" immediate="true"
            value="#{userBean.selectedAction}">
            <f:selectItem itemLabel="Seleccione..." itemValue="" />
            <f:selectItem itemLabel="Eliminar" itemValue="1" />
            <f:selectItem itemLabel="Recordar Contrasenia" itemValue="2" />
            <f:selectItem itemLabel="Editor" itemValue="3" />
          </h:selectOneMenu>
          <a4j:commandButton value="Aplicar" action="#{userBean.initAction}"
            reRender="formUsers,listActions,infoBox"></a4j:commandButton>
        </h:panelGroup>

        <h:panelGroup>
          <h:selectOneMenu id="selectPermission"
            value="#{userBean.selectedPermissionId}"
            requiredMessage="Es necesario un rol">
            <f:selectItems value="#{globalBean.loadListPermissions}" />
          </h:selectOneMenu>
          <h:message for="selectPermission" />
          <a4j:commandButton value="Asignar Rol"
            action="#{userBean.assingPermissions}" reRender="formUsers"></a4j:commandButton>
        </h:panelGroup>
      </h:panelGrid>

      <rich:dataTable id="dataTableUsers" width="100%"
        style="margin: 5px; margin-top: 12px;"
        binding="#{userBean.uiDataUserTable}"
        value="#{userBean.list_unitBeans}" var="unitUser">
        <f:facet name="header">
          <rich:columnGroup>
            <rich:column width="20px">
              <h:selectBooleanCheckbox />
            </rich:column>
            <rich:column>
              <h:outputText value="#{temp.username}" />
            </rich:column>
            <rich:column>
              <h:outputText value="#{temp.name}" />
            </rich:column>
            <rich:column>
              <h:outputText value="#{temp.gruops}" />
            </rich:column>
            <rich:column>
              <h:outputText value="#{temp.roles}" />
            </rich:column>
            <rich:column>
              <h:outputText value="#{temp.editor}" />
            </rich:column>
          </rich:columnGroup>
        </f:facet>
        <rich:column width="20px">
          <h:selectBooleanCheckbox binding="#{userBean.checked}" />
        </rich:column>
        <rich:column>
          <a4j:commandLink value="#{unitUser.username}"
            action="#{userBean.loadSelectUser}" rendered="true"
            oncomplete="javascript:Richfaces.showModalPanel('panelUserGroup')"
            reRender="editFormUserUnit,headerEditUser">
            <a4j:actionparam name="userId" value="#{unitUser.username}"
              assignTo="#{userBean.processedUserId}"></a4j:actionparam>
          </a4j:commandLink>
        </rich:column>
        <rich:column>
          <h:outputText value="#{unitUser.name}" />
        </rich:column>
        <rich:column>
          <a4j:repeat value="#{unitUser.listGroups}" var="group">
            <h:outputText value="#{group.groupName}" />
          </a4j:repeat>
        </rich:column>
        <rich:column>
          <a4j:repeat value="#{unitUser.listPermission}" var="per">
            <h:outputText value="#{per.description}," />
          </a4j:repeat>
        </rich:column>
        <rich:column>
          <h:outputText value="#{unitUser.publisher}" />
        </rich:column>
      </rich:dataTable>
    </a4j:form>
    <ui:fragment rendered="not #{userBean.oneRow}">
      <h3>#{temp.notfoundGroups}</h3>
    </ui:fragment>
    <!-- MODAL PANELS -->
    <rich:modalPanel id="panelUserGroup" autosized="true" width="200"
      height="60" zindex="2000">
      <f:facet name="header">
        <h:form id="formHeaderEditUser">
          <h:panelGroup>
            <h:outputText id="headerEditUser"
              value="Editanado a #{userBean.unitUserBean}"></h:outputText>
          </h:panelGroup>
        </h:form>
      </f:facet>
      <f:facet name="controls">
        <h:form>
          <h:panelGroup>
            <a4j:commandLink
              onclick="Richfaces.hideModalPanel('panelUserGroup')"
              ajaxSingle="true">
              <h:graphicImage value="#{url.img}/icons/close.png" />
            </a4j:commandLink>
          </h:panelGroup>
        </h:form>
      </f:facet>
      <h:form id="editFormUserUnit">
        <rich:tabPanel switchType="client">
          <rich:tab label="Datos Generales" focus="true">
            <p style="font-weight: bold;"><h:outputText
              value="Usuario desde #{userBean.unitUserBean.date_new}" /></p>
            <h:panelGrid columns="2" width="400px">

              <h:outputLabel value="Nombre de Usuario" for="username" />
              <h:inputText id="username"
                value="#{userBean.unitUserBean.username}" disabled="true"
                size="20" />
              <h:outputLabel value="Nombre Real" for="realName" />
              <h:inputText id="realName" value="#{userBean.unitUserBean.name}"
                required="true" requiredMessage="test" size="40" />

              <h:outputLabel value="Correo" for="email" />
              <h:inputText id="email" value="#{userBean.unitUserBean.email}"
                required="true" size="50" />

              <h:outputLabel value="Estado" for="status" />
              <h:panelGroup>
                <h:panelGrid columns="2">
                  <h:selectOneRadio id="status"
                    value="#{userBean.unitUserBean.status}">
                    <f:selectItem itemValue="true" itemLabel="Si" />
                    <f:selectItem itemValue="false" itemLabel="No" />
                  </h:selectOneRadio>
                </h:panelGrid>
              </h:panelGroup>
              <h:outputLabel value="Editor" for="editor" />
              <h:panelGroup>
                <h:panelGrid columns="2">
                  <h:selectOneRadio id="editor"
                    value="#{userBean.unitUserBean.publisher}">
                    <f:selectItem itemValue="S" itemLabel="Si" />
                    <f:selectItem itemValue="N" itemLabel="No" />
                  </h:selectOneRadio>
                </h:panelGrid>
              </h:panelGroup>
              <a4j:commandButton value="Actualizar Datos"
                action="#{userBean.updateUser}"
                oncomplete="Richfaces.hideModalPanel('panelUserGroup')"
                reRender="dataTableUsers"></a4j:commandButton>
              <h:inputHidden id="idHd" value="#{userBean.unitUserBean.id}" />
            </h:panelGrid>
          </rich:tab>
          <rich:tab label="Permisos">
            <h3>Permisos de Usuario</h3>
            <h:panelGrid columns="2" width="400px">

            </h:panelGrid>
            <h3>Permisos Territoriales</h3>
            <h:panelGrid columns="2" width="400px">

            </h:panelGrid>
          </rich:tab>
          <rich:tab label="Bitacora">
            <h:panelGrid columns="2" width="400px">
            </h:panelGrid>
          </rich:tab>
        </rich:tabPanel>
      </h:form>
    </rich:modalPanel>

    <!-- NEW USER -->

    <rich:modalPanel id="panelnewUserGroup" autosized="true" width="600"
      height="200" zindex="2000">

      <f:facet name="header">
        <h:form id="formHeaderNewtUser">
          <h:panelGroup>
            <h:outputText id="headerEditUser" value="Nuevo Usuario"></h:outputText>
          </h:panelGroup>
        </h:form>
      </f:facet>
      <f:facet name="controls">
        <h:form>
          <h:panelGroup>
            <a4j:commandLink
              onclick="Richfaces.hideModalPanel('panelnewUserGroup')"
              ajaxSingle="true">
              <h:graphicImage value="#{url.img}/icons/close.png" />
            </a4j:commandLink>
          </h:panelGroup>
        </h:form>
      </f:facet>

      <b>Como agregar un usuario al Sistema</b>
      <br />
      <p>Existen tres formas para agregar un usuario, puede ser
      directamente ingresando sus datos, enviando una invitacion y el
      usuario directamente agregara sus datos o buscandolo en el LDAP de la
      empresa.</p>
      <rich:panelBar>
        <rich:panelBarItem label="Agregar Usuario Directamente">
          <h:form id="newFormUserUnit">
            <h:panelGrid columns="2" cellpadding="1" width="400px">
              <h:outputLabel value="Nombre de Usuario" for="username" />
              <h:inputText id="username"
                value="#{userBean.newUnitUserBean.username}" size="20" />
              <h:outputLabel value="Nombre Real" for="realName" />
              <h:inputText id="realName"
                value="#{userBean.newUnitUserBean.name}" required="true"
                requiredMessage="test" size="40" />
              <h:outputLabel value="Correo" for="email" />
              <h:inputText id="email" value="#{userBean.newUnitUserBean.email}"
                required="true" size="40" />
              <h:outputLabel value="Estado" for="status" />
              <h:panelGroup>
                <h:panelGrid columns="2">
                  <h:selectOneRadio id="status"
                    value="#{userBean.newUnitUserBean.status}">
                    <f:selectItem itemValue="1" itemLabel="Activo" />
                    <f:selectItem itemValue="0" itemLabel="Inactivo" />
                  </h:selectOneRadio>
                </h:panelGrid>
              </h:panelGroup>
              <h:outputLabel value="Editor" for="editor" />
              <h:panelGroup>
                <h:panelGrid columns="2">
                  <h:selectOneRadio id="editor"
                    value="#{userBean.newUnitUserBean.publisher}">
                    <f:selectItem itemValue="S" itemLabel="Si" />
                    <f:selectItem itemValue="N" itemLabel="No" />
                  </h:selectOneRadio>
                </h:panelGrid>
              </h:panelGroup>
              <h:outputLabel value="Duenio" for="duenio" />
              <h:panelGroup>
                <h:panelGrid columns="2">
                  <h:selectOneRadio id="duenio"
                    value="#{userBean.newUnitUserBean.publisher}">
                    <f:selectItem itemValue="S" itemLabel="Si" />
                    <f:selectItem itemValue="N" itemLabel="No" />
                  </h:selectOneRadio>
                </h:panelGrid>
              </h:panelGroup>
              <a4j:commandButton value="Crear" action="#{userBean.createUser}"
                oncomplete="Richfaces.hideModalPanel('panelnewUserGroup')"
                reRender="dataTableUsers"></a4j:commandButton>
            </h:panelGrid>
          </h:form>
        </rich:panelBarItem>
        <rich:panelBarItem label="Invitar Usuario por Correo">
          <h:form id="newFormUserUnit2">
            <p>Introduce una lista de correos, separados por una coma.
            Cada uno de ellos recibira una invitacion valida por un tiempo
            determinado, donde podran registrarse.</p>
            <h:panelGrid columns="2" cellpadding="2" width="400px">
              <h:outputLabel value="Escribe el Correo" for="" />
              <h:inputTextarea value="#{userBean.listUsers}" cols="40" rows="5"
                required="true" />
              <a4j:commandButton value="Enviar Ivitacion"
                action="#{userBean.inviteUser}"
                oncomplete="Richfaces.hideModalPanel('panelnewUserGroup')"
                reRender="newFormUserUnit2"></a4j:commandButton>
            </h:panelGrid>
          </h:form>
        </rich:panelBarItem>
        <rich:panelBarItem label="Buscar en LDAP">
          <h:form id="newFormUserUnit3">
            <h:panelGrid columns="2" cellpadding="2" width="400px">
              <h:outputLabel value="Nombre de Usuario" for="" />
              <h:inputText value="" size="40" />
              <a4j:commandButton value="Buscar"></a4j:commandButton>
            </h:panelGrid>
            <h4>Usuarios Encontrados</h4>

          </h:form>
        </rich:panelBarItem>
      </rich:panelBar>
    </rich:modalPanel>
  </ui:define>
</ui:composition>
