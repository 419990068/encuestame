<ui:composition template="/templates/surveyTemplate.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.prime.com.tr/ui"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
    <ui:define name="title">TweetPoll</ui:define>
    <ui:define name="panel">
        <h:form>
         <p:accordionPanel width="100%">
             <p:tab title="Personalization">
                <h:commandLink value="Create Tweet" action="createTweetPoll" />
                <br></br>
                <h:commandLink value="List Tweet" action="tweetpoll" />
            </p:tab>
            <p:tab title="Credentials">
                <h:commandLink value="Credentials" action="createTweetPoll" />
            </p:tab>
         </p:accordionPanel>
        </h:form>
    </ui:define>
    <ui:define name="bodyOptions">
        <h:form>
            <p:messages showDetail="true" />
            <p:dataTable var="item" id="tweetPollTable" value="#{tweetPolls.listTweets}"
                paginator="true" rows="20" width="100%"
                selection="#{tweetPolls.selectedTweetPoll}"
                selectionMode="single" update="tabDialogView"
                onselectComplete="tweetDialog.show()">
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Id" />
                    </f:facet>
                    <h:outputText value="#{item.id}" />
                </p:column>

                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Question Name" />
                    </f:facet>
                    <h:outputText
                        value="#{item.questionBean.questionName}" />
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Publicada?" />
                    </f:facet>
                    <h:outputText value="#{item.publishPoll}" />
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="" />
                    </f:facet>
                    <h:outputText value="#{item.publicationDateTweet}" />
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="TwitterId" />
                    </f:facet>
                    <h:outputText value="#{item.tweetId}" />
                </p:column>
            </p:dataTable>
        </h:form>
            <p:dialog header="Tweet Poll Detail" widgetVar="tweetDialog"
                modal="true" fixedCenter="true" draggable="false"
                width="650px">
                <p:tabView id="tabDialogView">
                    <p:tab title="Details">
                        <h:form style="padding:20px;" id="detailsForm">
                            <h:outputText value="#{tweetPolls.selectedTweetPoll.questionBean.questionName}"  style="font-size:16px;font-weight:bold;"/>

                            <p:messages showDetail="true" showSummary="true">
                                <p:effect type="pulsate" event="load">
                                  <f:param name="times" value="2" />
                                </p:effect>
                            </p:messages>

                            <ui:fragment rendered="#{tweetPolls.selectedTweetPoll.publishPoll}">
                                <h:panelGrid columns="2" cellpadding="2" cellspacing="2">
                                    <h:outputText value="Fecha Publicado" />
                                    <h:outputText value="#{tweetPolls.selectedTweetPoll.publicationDateTweet}" />
                                    <h:outputText value="Url Tweet" />
                                    <h:outputLink value="#{tweetPolls.selectedTweetPoll.tweetUrl}" target="_blank">
                                        <h:outputText value="#{tweetPolls.selectedTweetPoll.tweetUrl}"/>
                                    </h:outputLink>
                                </h:panelGrid>
                            </ui:fragment>

                            <ui:fragment rendered="#{!tweetPolls.selectedTweetPoll.publishPoll}">
                            <h:panelGrid columns="2" cellpadding="2" cellspacing="3">
                                <h:outputLabel value="Question"/>
                                <h:inputText value="#{tweetPolls.selectedTweetPoll.questionBean.questionName}" />
                                <h:outputLabel value="Allow Live Results"/>

                            </h:panelGrid>
                            <h:panelGrid columns="1" cellpadding="2" cellspacing="2">
                                <p:commandLink value="Change Answers" action="#{tweetPolls.changeEdit}" update="detailsForm"/>
                            </h:panelGrid>
                            <ui:fragment rendered="#{tweetPolls.editAnswer}">
                                    <a4j:repeat value="#{tweetPolls.selectedTweetPoll.questionBean.listAnswers}" var="answer">
                                             <h:panelGrid columns="2" cellpadding="2" cellspacing="2"  >
                                                <h:outputLabel value="Answer"/>
                                                <h:inputText value="#{answer.answers}">
                                                    <a4j:support event="onchange" action="#{tweetPolls.saveAnswer}"
                                                         reRender="detailsMessages, detailsForm">
                                                        <a4j:actionparam name="answerId" value="#{answer.answerId}"
                                                         assignTo="#{tweetPolls.answerIdUpdate}"></a4j:actionparam>
                                                    </a4j:support>
                                                </h:inputText>
                                             </h:panelGrid>
                                     </a4j:repeat>
                                </ui:fragment>
                                <p:commandButton value="Publish TweetPoll" action="#{tweetPolls.saveChanges}"/>
                                <p:commandButton value="Save Changes" action="#{tweetPolls.publishTweet}"/>
                            </ui:fragment>

                         </h:form>
                    </p:tab>
                    <p:tab title="Results" rendered="#{tweetPolls.selectedTweetPoll.publishPoll}">
                     <p:pieChart id="display" value="#{tweetPolls.selectedTweetPoll.results}" var="tweet" categoryField=" #{tweet.label}"
                                  dataField="#{tweet.result}" />
                     </p:tab>
                    <p:tab title="Retweets">
                    </p:tab>
                </p:tabView>
            </p:dialog>

    </ui:define>
</ui:composition>
